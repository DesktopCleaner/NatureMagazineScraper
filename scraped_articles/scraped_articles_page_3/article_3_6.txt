*** Advanced urothelial cancer is a frequently lethal disease characterized by marked genetic heterogeneity1. In this study, we investigated the evolution of genomic signatures caused by endogenous and external mutagenic processes and their interplay with complex structural variants (SVs). We superimposed mutational signatures and phylogenetic analyses of matched serial tumours from patients with urothelial cancer to define the evolutionary dynamics of these processes. We show that APOBEC3-induced mutations are clonal and early, whereas chemotherapy induces mutational bursts of hundreds of late subclonal mutations. Using a genome graph computational tool2, we observed frequent high copy-number circular amplicons characteristic of extrachromosomal DNA (ecDNA)-forming SVs. We characterized the distinct temporal patterns of APOBEC3-induced and chemotherapy-induced mutations within ecDNA-forming SVs, gaining new insights into the timing of these mutagenic processes relative to ecDNA biogenesis. We discovered that mostCCND1amplifications in urothelial cancer arise within circular ecDNA-forming SVs. ecDNA-forming SVs persisted and increased in complexity, incorporating additional DNA segments and contributing to the evolution of treatment resistance. Oxford Nanopore Technologies long-read whole-genome sequencing followed by de novo assembly mapped outCCND1ecDNA structure. Experimental modelling ofCCND1ecDNA confirmed its role as a driver of treatment resistance. Our findings define fundamental mechanisms that drive urothelial cancer evolution and have important therapeutic implications.

*** Mutagenesis and DNA repair constantly interact during cancer, resulting in distinct mutational signatures and extensive structural genomic changes. The apolipoprotein B mRNA-editing enzyme catalytic subunit 3 (APOBEC3) cytidine deaminases3cause somatic mutational signatures characterized by cytosine to thymine or guanine substitutions in the genomes of various human cancers, especially urothelial carcinoma (UC)3,4,5. In a previous study1, we investigated the evolutionary dynamics of chemotherapy-resistant advanced UC. However, several fundamental questions remain: (1) how and whether the relative timing, clonality and velocity of endogenous mutagenic stresses (for example, APOBEC3) and extrinsic mutagenic processes (for example, chemotherapy) shape UC evolution and (2) how high-order SVs, including ecDNA, shape UC evolution and drug resistance. Our ability to predict the clinical trajectory and prevent drug resistance in patients with advanced cancer depend on answering these fundamental questions.

*** To address these questions, we performed whole-genome sequencing (WGS) of matched sets of primary and metastatic UC tumours and morphologically normal urothelial samples. We analysed single base substitution (SBS), doublet base substitution (DBS) and small insertion and deletion (indel; ID) mutational signatures and superimposed them on phylogenetic maps of primary and metastatic tumours collected at different time points. We compared the relative timing and clonality of these mutagenic processes over the patients’ lifespan. We then applied junction balance analysis (JaBbA)2to serially collected tumour samples to analyse the topology of complex SVs and track ecDNA evolution. We investigated the patterns and the timing of APOBEC3 and chemotherapy-induced mutations within ecDNA-forming SV events. We mapped the changes in ecDNA-forming SV events following systemic therapy to gain insights into their role as putative drivers of drug resistance. We reconstructed the genetic maps of recurrentCCND1ecDNA-forming SVs. We mapped out the circular structure of ecDNAs using state-of-the-art Oxford Nanopore Technologies (ONT) long-read WGS. Finally, using two different experimental models, we demonstrate the fitness advantage ofCCND1ecDNA in driving resistance to therapy.

*** We performed WGS of 77 urothelial tumours from 50 patients, including 28 pre-platinum and 49 post-platinum chemotherapy samples from comparable-quality freshly frozen (FF) and formalin-fixed paraffin-embedded (FFPE) tissues (Extended Data Fig.1aand Supplementary Tables1–3). The APOBEC3 cytidine deaminases are the dominant mutagenic enzymes in UC. We found that signatures SBS2 (refs.4,6), SBS13 (refs.4,6) and DBS11 (ref.4) contributed an average of 17%, 20% and 17%, respectively, of all corresponding mutations in our cohort (Extended Data Fig.1b,c). ID9 (ref.4), a signature characterized by single cytidine deletions, correlated with APOBEC3-induced SBS signature contributions (R= 0.67) (Extended Data Fig.1d). As expected, there was no significant correlation between our recently described APOBEC3G-induced mutational signature with APOBEC3A and APOBEC3B SBS2 and SBS13 signatures (R= −0.24,P= 0.20) or chemotherapy-associated SBS31 and SBS35 signatures (R= −0.11,P= 0.56)7. Contributions of endogenous mutational signatures did not differ between matched primary and metastatic tumours from the same patient (Extended Data Fig.1e). Next, we investigated the SBS31 (refs.4,8), SBS35 (refs.4,8) and DBS5 (refs.4,9) signatures associated with platinum-based chemotherapy, the backbone of treatment regimens for advanced UC (Extended Data Fig.1c). We observed contributions from SBS31 (mean 18%), SBS35 (mean 3%) and DBS5 (mean 23%) (Extended Data Fig.1c) in the post-chemotherapy tumours.

*** We then generated phylogenetic trees for patients with at least two tumour samples to determine the timing and clonality of mutagenic processes over the arc of tumour progression. By fitting signatures at each node, we superimposed the mutational signature composition onto the phylogenetic tree to show dynamic signature changes over time (Methods, Fig.1aand Extended Data Fig.2). In 11 out of 14 reconstructed evolutionary trees, SBS2 and SBS13 dominated the early truncal nodes, constituting ≥25% of all mutations and persisting throughout the lifetime of the tumour (Extended Data Fig.2). This result underscores the role of APOBEC3 in both urothelial carcinogenesis and progression. Chemotherapy-induced mutations were more prevalent in ‘leaf’ nodes compared with APOBEC3 mutations (P= 5.9 × 10−5), matching the late timing of therapy (Fig.1b).

*** a, Phylogenetic tree depicting UC evolution for patient WCMIV063. Each node represents SNVs (centre), mean CCF across all SNVs within the node (blue numbers) and genes affected by high-impact SNVs. SBS, DBS and ID signature proportions are represented as concentric circles (periphery to the centre, respectively) within each node. The number of samples collected from different tumour sites is indicated on the human body diagram. Illustration of a human adapted from ref.1, Springer Nature America.b, Leaf/trunk variant fold change of platinum chemotherapy-induced and APOBEC-induced variants.n= 12 tumours,P= 5.91 × 10−5.c, Clonality fold change of APOBEC3 (SBS2 and SBS13), chemotherapy (SBS31 and SBS35) and ageing (SBS1) mutational signatures in 44 post-chemotherapy tumours.n= 28 (ageing),n= 29 (chemotherapy),n= 42 (APOBEC). Early/late APOBEC–chemotherapy:P= 2.1 × 10−7; early/late ageing–chemotherapy:P= 1.8 × 10−4; clonal/subclonal APOBEC–chemotherapy:P= 4.3 × 10−4.d, Velocity fold change of APOBEC3-induced, chemotherapy-induced and ageing-associated mutagenesis.n= 34 (APOBEC SBS),n= 30 (chemotherapy SBS),n= 28 (APOBEC DBS),n= 24 (chemotherapy DBS) patients. APOBEC SBS–chemotherapy SBS:P= 0.0139; APOBEC DBS–chemotherapy DBS:P= 7.0 × 10−4.e, Upset and alluvial plots depicting shared SBS2 and SBS13 mutations (top, vertical bars) between normal urothelium and metastatic UC tumours in patient WCMIVG010. S on theyaxis of the bottom plot indicates the sample identifier. Alluvialyaxes represent SNV counts. Image of human bladder created by Servier (https://smart.servier.com/) and adapted from Bioicons (https://bioicons.com/), under aCC BY 3.0licence.f, Maximum likelihood estimates of dN/dS ratios for significant genes (q< 0.1). Circle size represents coding SNV counts across the cohort. Colour indicates the proportion of APOBEC3-induced coding mutations.TP53had the highest dN/dS values (inset, top-right corner). Two-sided Wilcoxon rank-sum test was used inb–d. Unless otherwise specified, boxes show the median and the interquartile range (IQR); the lower whisker indicates Q1 – 1.5 × the IQR; the upper whisker indicates Q3 + 1.5 × the IQR. *P< 0.05, **P< 0.01, ***P< 0.001, ****P< 0.0001, NS, not significant.

*** Source Data

*** We classified the clonality of somatic mutations in each of the 71 tumours (Methods). Consistent with the patterns observed in the phylogenetic trees, APOBEC3-induced mutations were significantly earlier (1.85-fold compared with 0.48-fold,P= 2.1 × 10−7) and more clonal (1.49-fold compared with 0.8-fold,P= 4.3 × 10−4) than chemotherapy-induced mutations (Fig.1cand Extended Data Fig.3a). Comparing SBS signature clonality between post-chemotherapy and pre-chemotherapy samples revealed significantly more clonal early APOBEC3-induced mutations in chemotherapy-treated tumours (P= 0.012) but not other signatures (P> 0.05) consistent with selection of clones habouring APOBEC3-induced mutations under therapeutic pressure (Extended Data Fig.3b).

*** Next, we compared the fold change in the mutagenic velocity of APOBEC3 and chemotherapy relative to the ageing signature SBS1 per month of exposure. Chemotherapy exposure resulted in higher mutational rates than APOBEC3 for both SBS (P= 0.014) and DBS (P= 7.0 × 10−4) (Methods, Fig.1dand Extended Data Fig.3c). Smoking history did not affect APOBEC3-associated SBS2, SBS13 or DBS11 mutational velocities (P> 0.05) (Extended Data Fig.3d). Notably, platinum-based chemotherapy generated hundreds of SBS and a few DBS mutations per month of exposure (Fig.1dand Extended Data Fig.3c). We identified deleterious SBS31-assigned C[C>T]T splice variants inACVR2A,SLC34A2andJAK2, but no recurrent chemotherapy-induced gene mutations were observed (Extended Data Fig.3e). Cisplatin exposure was also associated with mutations in the putative tumour-suppressor genesDCCandARID1B(Extended Data Fig.3e). We examined regulatory elements and found no significant difference in their mutation rates between noncoding regions affected by platinum chemotherapy and ageing SBS1 (P> 0.05) (Supplementary Table4). Furthermore, none of the five significantly mutated noncoding regulatory regions had SBS31 or SBS35 mutations, indicating limited impact on driver gene regulation (Methodsand Supplementary Table4). Gene-list enrichment analysis of SBS31 and SBS35 mutations exclusive to platinum chemotherapy-treated patients revealed enrichment in the IFNγ pathway (odds ratio (OR) = 34.4; adjustedP= 0.0018), ERBB4 signalling (OR = 33.46; adjustedP= 0.0022) and VEGFR3 signalling (OR = 53.27; adjustedP= 0.0014). The PDGFRβ signalling pathway (OR = 20.31; adjustedP= 5.6 × 10−5) and signalling pathways regulated by the RET tyrosine kinase (OR = 33.46; adjustedP= 0.0022) (Methodsand Extended Data Fig.3f) were also enriched. This suggested involvement of these pathways in tumour progression and drug resistance. Together, these data show that chemotherapy induces bursts of subclonal mutations that potentially affect tumour progression.

*** Based on the early and clonal distribution of APOBEC3-induced mutations (Fig.1c), we proposed that APOBEC3 mutagenesis drives urothelial carcinogenesis. Thousands of APOBEC3-induced mutations, including high- to moderate-impact driver mutations inARID1A,PARD3,CYP51A1andSETBP1, were shared between urothelial tumours and morphologically normal urothelium (Methods, Fig.1eand Extended Data Fig.3g). The median cancer cell fraction (CCF) of high-impact APOBEC3-induced mutations was 1.0 in chromatin-modifying genes associated with early urothelial field defects10,11,12, supporting their clonal nature (Extended Data Fig.3hand Supplementary Table5). Notably, three SBS13-associated high-impactARID1Amutations were shared by one normal urothelium sample and three distinct tumours in patient WCMIVG010 (Extended Data Fig.1e).

*** Furthermore, we analysed the ratio of nonsynonymous to synonymous mutations (dN/dS) and identified an enrichment of APOBEC3-induced mutations in crucial oncogenes (PIK3CA) and tumour suppressor genes (TP53,RB1,KDM6AandARID1A), with dN/dS ratios of >10. This result suggests that APOBEC3-induced mutations in these genes have undergone intense and persistent selection, potentially providing a fitness advantage that predates tumorigenesis (Methodsand Fig.1f).

*** Consistent with the role of APOBEC3-induced mutagenesis as an initiating event of DNA damage in early carcinogenesis, we observed a significant increase in the percentage of cells with pRPA and γH2AX foci (P< 0.0001), markers of single-stranded DNA (ssDNA) and DNA double-strand breaks (DSB), respectively, after regulated induction of APOBEC3A in isogenic UC cell lines (Methodsand Extended Data Fig.3i). Furthermore, we identified an enrichment of SBS2 and SBS13-induced composite mutations13in cancer-associated genes, including chromatin-modifying genes (KMT2D,KDM6A,KMT2A,ARID1AandARID2) in UC tumours, consistent with the processive nature of APOBEC3 enzymes (Supplementary Table6). These composite mutations potentially augment the selective fitness of the initial singleton mutations13and promote urothelial carcinogenesis.

*** Our findings suggest that early APOBEC3-induced mutations drive urothelial carcinogenesis. This is significant because APOBEC3-induced mutagenesis accounts for up to 67% of all single nucleotide variants (SNVs) in UC14. Furthermore, our data show the interplay between the early clonal APOBEC3-induced mutations and the late subclonal bursts of chemotherapy-induced mutations, which cooperate to shape metastatic and treatment-resistant phenotypes.

*** Genomic instability emerges from the the interplay between mutations and complex, large-scale chromosomal variants15. To investigate these processes, we used JaBbA2to provide a comprehensive analysis of higher-order SVs within our Weill Cornell Medicine (WCM)-UC cohort (Methods, Fig.2aandSV glossary). We identified a median of 19 SVs per sample (interquartile range (IQR) of 9–36), and 84.5% had one or more complex SVs (median of 2, IQR of 1–5) (Fig.2a). In our WCM-UC cohort, templated-insertion chains (TICs) (49.3%), chromoplexy (33.8%) and breakage–fusion–bridges (BFBs) (31%) were the most prevalent complex SV events (Extended Data Fig.4a). Notably, 11.3% harboured ‘tyfonas’2, carrying a significantly higher SV junction burden than other complex SVs (P< 7.8 × 10−5) (Extended Data Fig.4b). Duplications in the genome were associated withTP53SNV and indel (SNV/indel) mutations (P= 1.0 × 10−6, false discovery rate (FDR) = 7.2 × 10−3) (Supplementary Table7). Duplication, translocation and chromothripsis were associated withFGFR3SNVs/indels (P= 3.7 × 10−5, FDR = 0.10),FBXW7(P= 1.7 × 10−4, FDR = 0.23) andCDKN2Ahomozygous deletions (P= 1.7 × 10−4, FDR = 0.12) (Supplementary Table7). We also characterized COSMIC signatures positively (for example, SBS40 and chromoplexy, FDR-adjustedP= 0.021) or negatively correlated with SV events (for example, ID11 and chromoplexy, FDR-adjustedP= 0.021) (Methodsand Extended Data Fig.4c–e).

*** a, Heatmap displaying junction burdens of complex SVs (yaxis) in 71 UC tumours (xaxis). Tyfonas, BFBs and DMs are grouped by their association with ecDNA. The heatmap is normalized to the average junction burden of our cohort and scaled in the natural log. Other complex SVs, from top to bottom, include chromothripsis, chromoplexy, TICs, quasi-reciprocal pairs, rigma and pyrgo.b, Schematic depicting the impact of APOBEC3 and chemotherapy-induced mutagenesis on ecDNA biogenesis during cancer evolution. Images of chromosomes were created by KKT Madhusanka and adapted from Adobe Stock (https://stock.adobe.com).c, Proportion of kataegic events co-localizing with SVs. DM (non-ecDNA) events were identified by JaBbA but not classified as ‘cyclic’ by AmpliconArchitect.d, Kataegic events on ecDNA-forming SVs showed a significantly shorter median distance to the nearest breakpoint compared to kataegis on other non-ecDNA SVs and kataegis without SV association. ecDNA-forming SVs median size in this cohort was 5.56 Mb, used as the upper limit of the distance to the closest breakpoints for kyklonas. The median distance of all mutations within a kataegic event was collapsed to one measurement per event. Two-sided Wilcoxon rank-sum test.e, Violin plots of VAF distributions for APOBEC3-induced kyklonic mutations (n= 147) and chemotherapy-induced SNVs (n= 716) on ecDNA-forming SVs. Plots extend between the maximum and minimum of the distribution. Two-sided Wilcoxon rank sum test.P< 2.22 × 10−16.f, Contributions of mutational signatures with sample/VAF tranche combinations in all ecDNA-forming SVs. Only tranches with >100 mutations are displayed.g, ecDNA-forming SVs harbouring ≥1 kyklonic event in patient WCMIVG035S01. CN track: JaBbA genome graph showing CNs for rearranged DNA segments (grey vertices) with SV junctions (aqua blue edges) within circular ecDNA events. Kyklonas track: normalized VAF of kyklonic mutations. Non-clustered track: normalized VAF of non-clustered APOBEC3-induced and platinum-induced signature mutations on ecDNA-forming SVs.

*** Source Data

*** No correlation between APOBEC3-induced mutations and specific SV categories was identified (Extended Data Fig.4f). However, patients over 60 years old had a higher fraction of the genome altered (P= 0.0023) than patients aged under 60 years (Extended Data Fig.4g). Moreover, UC tumours withTP53mutations exhibited a significantly higher fraction of the genome altered (P< 0.001) and number of total junctions (P= 4.9 × 10−7) and several SV classes (for example, duplications,P= 2.0 × 10−7; BFB,P= 4.6 × 10−5) (Extended Data Fig.4h). These findings suggest that the underlying genomic instability due to mutations in genomic integrity guardians likeTP53is crucial to the biogenesis of complex SVs.

*** Cancer cell ecDNA is a megabase-scale circular DNA subclass that amplifies oncogenes16. To detect ecDNA-forming SVs, we focused on two defining characteristics: (1) amplicons with high copy numbers (CNs) and (2) circular structure. Within the JaBbA framework, tyfonas, BFBs or double minutes (DMs)2are amplicons with CNs twofold higher than the genomic ploidy, thereby satisfying the first criterion. Further analysis revealed that tyfonas (100%), BFBs (81.5%) and DMs (63.2%) were the most common JaBbA-defined events that overlapped with the circular event annotations by AmpliconArchitect17, which implicated their association with ecDNAs2,18,19(Extended Data Fig.4i). JaBbA identified larger amplification events encompassing those identified by AmpliconArchitect (Extended Data Fig.4j,k). We determined that 35% of samples in our cohort harboured one or more events that could generate ecDNA-forming SVs, highlighting their high prevalence in UC.

*** By juxtaposing APOBEC3 and chemotherapy-induced mutations on ecDNA-forming SVs, we aimed to uncover  the chronology and mechanisms of ecDNA biogenesis (Fig.2b). APOBEC3-induced clustered mutations in ecDNA (kyklonas)20were found in 69% of 42 ecDNA-forming SV events (Fig.2cand Extended Data Fig.5). Kyklonas occurred near SV breakpoints with a median distance of 16.2 kb, with 48.6% within 10 kb, and were significantly closer to SV junctions than chromosomal kataegic events (P< 0.001) (Fig.2d). The topographical proximity of APOBEC3-induced kyklonic events and SV breakpoints suggests APOBEC3-induced DSB as an intermediary step in ecDNA biogenesis.

*** ecDNA-forming SVs mainly harboured APOBEC3-induced SBS2 and SBS13, followed by chemotherapy-associated SBS31 and SBS35, with minimal contributions from tobacco smoking-associated SBS4, SBS29 and SBS92 (Extended Data Fig.6a). To investigate the relative timing of APOBEC3 and chemotherapy-induced mutagenesis in relation to ecDNA biogenesis, we examined the variant allele frequency (VAF) of APOBEC3 kyklonic clusters and non-clustered chemotherapy mutations on ecDNA-forming SVs. Kyklonas events had a significantly higher VAF than chemotherapy mutations in ecDNA (P< 2.22 × 10−16) (Fig.2e). Overall, 10.2% of kyklonic mutations occurred early in the evolution of UC (VAF > 0.67), whereas 93.4% (669 out of 716) of chemotherapy-induced mutations on ecDNA-forming SVs had low VAF < 0.33 (Fig.2f,gand Extended Data Fig.5). Further analysis showed that the APOBEC3-induced mutational burden was significantly higher in ecDNA-forming SVs than in non-ecDNA regions (P= 1.3 × 10−5) (Extended Data Fig.6b). These findings suggest that APOBEC3-induced mutagenesis and ecDNA biogenesis overlap topographically and chronologically.

*** To identify recurrent ecDNA-driven oncogene amplification, we used FishHook to search for regions with recurrent structural variation (Methods). FishHook identified 31 loci, 17 (55%) of which were within 500 kb of a cancer-related gene (CCND1,AXIN2,CHEK2,ERBB2,FHIT,KRAS,MDM2orNUMA1) (Extended Data Fig.7a). We identified 4 out of 71 samples showingERBB2amplification in ecDNA-forming SVs, including DM, BFB or tyfonas events (Extended Data Fig.7b). All four JaBbAERBB2SV events were part of AmpliconArchitect cyclic ecDNA calls and showed extremely highERBB2CNs (median of 30, range of 11–285) (Extended Data Fig.7c). Notably, the 11q13.3 locus containingCCND1was involved in most SVs (13 samples), 92% of which were ecDNA-forming SVs (Extended Data Fig.7b).

*** Using AmpliconArchitect and JaBbA, we identified ecDNA-forming SV events in 67% (10 out of 15) of WCM-UC tumours withCCND1amplification (Fig.3a). These events had a mean CN of 47, 3.6-fold higher than other non-cyclicCCND1amplifications (Extended Data Fig.3a). To validate these findings, we examinedCCND1ecDNA amplification in the dataset previously analysed by AmpliconArchitect21,22, which includes a subset of tumours from The Cancer Genome Atlas (TCGA) and Pan-Cancer Analysis of Whole Genomes (PCAWG) pan-cancer cohorts (n= 3,731 andn= 1,291, respectively). Amplification through ecDNA-forming SVs was found in 70% of TCGA/PCAWG bladder cancer cases withCCND1amplification. This is the second-highest following pancreatic adenocarcinoma (75%) and higher than ovarian (67%) and oesophageal (59%) cancers (Fig.3a). Pan-Cancer Atlas analysis of patients withCCND1alterations in 32 cancer types showed significantly worse overall survival (P< 0.0001) and disease-free survival (P= 0.002), which highlighted the correlation betweenCCND1high CN and poor clinical outcomes (Extended Data Fig.7d). Cyclin D1 forms a complex with CDK4 and CDK6 (CDK4/6) to phosphorylate RB1. This releases the E2F transcription factors, which orchestrate cell cycle progression through the G1/S checkpoint23.CDKN2Aencodes p16 (p16INK4a), a tumour suppressor that inhibits CDK4/6 (Fig.3b). In our cohort, homozygousCDKN2Aloss was significantly more common in tumours withCCND1amplification, including those withCCND1ecDNA-forming SVs (P= 0.041), than in tumours with other amplifications (Extended Data Fig.3a). In samples withCCND1ecDNA amplification, 87% hadCDKN2Adeletions (mean CN fold change relative to ploidy of 0.34), whereas the downstream signalling pathway genesCDK4,CDK6andRB1were predominantly wild type (Fig.3b). RNA sequencing of a subset of the tumours in our cohort confirmed that tumours withCCND1gain had significantly higher normalizedCCND1mRNA expression (adjustedP= 0.038, log2(fold change) = 1.26) (Fig.3c). Our results suggest that UC tumours with ecDNA-mediatedCCND1amplification activate the p16–cyclin D1–CDK4/6–RB1 pathway.

*** a, Distribution of circular, heavily rearranged, linear or non-cyclic amplicons in samples withCCND1amplification from our WCM bladder cancer (BLCA-WCM) cohort, BLCA-TCGA cohort and TCGA/PCAWG pan-cancer subset cohorts analysed in a previous study22.b, Top, schematic of the p16–cyclin D1–CDK4/6–Rb pathway. Bottom, normalized CN alteration heatmap of chromosomal regions 9p21.3 (CDKN2A), 11q13.3 (CCND1) and genesCDK4andCDK6andRB1in 71 UC tumours. Chromosomal regions and genes are not drawn to scale.c, NormalizedCCND1andLTO1mRNA expression.d, ecDNA-forming SV events (up to 3 MB) in post-chemotherapy (post-chemo) tumours had significantly higher mean JCN (P= 0.016) and maximum JCN (P= 0.032) than ecDNA-forming SV events in pre-chemotherapy (pre-chemo) tumours.n= 15 events in 12 tumours. Two-sided Wilcoxon rank-sum test. Each dot represents one ecDNA-forming SV event.e–h, Combined genome graphs of AmpliconArchitect (top track) with JaBbA (CN and read depth tracks). JaBbA tracks show the chromosomal locations and CN alteration for DNA segments (black vertices) and the corresponding JaBbA SV events (coloured edges) in patient WCMIV091 (e,f) and in patient WCMIV076 (g,h) before (e,g) and after (f,h) systemic therapy for primary bladder tumour. Patient WCMIV091 was treated with neoadjuvant abemaciclib, a CDK4/6 inhibitor, for 4 weeks as part of a clinical trial. Patient WCMIV076 received a neoadjuvant combination of gemcitabine (Gem) and cisplatin (Cis). Top right schematics show that in patient WCMIV091,FGFR1was rearranged withCCND1in the same ecDNA, whereas in patient WCMIV076,FGF19andCCND1were co-amplified in ecDNA. The chromosomal locations ofCCND1,FGFR1andFGF19are highlighted in red.

*** Source Data

*** To understand the role of ecDNA in therapy resistance, we investigated the dynamics of ecDNA-forming SV events in matched tumours from patients undergoing systemic therapy. For ecDNA-forming SV events up to 3 Mb, post-chemotherapy tumours had significantly higher mean and maximum junction copy number (JCN) (P= 0.016 andP= 0.032, respectively) than chemotherapy-naive tumours, suggesting increased genetic complexity following treatment (Fig.3d). After systemic treatment,CCND1ecDNA-forming SV events increased their integer CN, which reflects the mean CN of ecDNAs per cell, from 17 to 26 in patient WCMIV091 and from 12 to 24 in patient WCMIV076 (Fig.3e–h). This increase is consistent with mathematical models of ecDNA selection under positive selection24. AmpliconArchitect reconstruction of ecDNA structures showed co-amplification ofFGFR1andFGF19withCCND1in patient WCMIV091 and patient WCMIV076, respectively, and confirmed their CN increases following systemic therapy (Fig.3e–h). Collectively, these data show the high prevalence of ecDNA-mediatedCCND1amplification in UC and suggest it has a role in drug resistance.

*** We constructed genomic maps ofCCND1ecDNA-forming SV amplicons and discovered that each amplicon is unique in structure, acquiring promoters, enhancers and super-enhancers of distinct oncogenes such asERBB4andLRP5(Extended Data Figs.8aand9). Our maps revealed the common amplification of oncogenesFGF3,FGF4andFGF19and the preservation ofCCND1local promoter and regulatory elements in the sharedCCND1ecDNA-forming SV regions (Extended Data Fig.8b).

*** To further characterize the genetic map ofCCND1ecDNA, we performed ONT long-read WGS of a bladder tumour from patient WCMIVG101, followed by de novo assembly of the putative ecDNA using Flye (Methodsand Extended Data Fig.8c). De novo assembly produced an 840 kb circular contig (Extended Data Fig.8d). We queried both ends of the circularizing junction for split-read alignments and found 1,028 reads that precisely supported the junction (with 768 reads anchored on ≥1 kb on each side, 100 reads anchored ≥5 kb on each side, and one read spanning ≥10 kb on each side) (Extended Data Fig.8e). Interphase fluorescence in situ hybridization (FISH) confirmed significantCCND1amplification (Methodsand Extended Data Fig.10a).

*** We experimentally modelled the extrachromosomal configuration ofCCND1and examined its selective fitness relative to chromosomal amplification under therapeutic pressure. To that end, we transduced the UMUC3 bladder cancer cell line, which harboursCCND1chromosomal gain, with a non-integrating lentiviral episomal vector harbouringCCND1–mCherry or a control-GFP vector (Methodsand Extended Data Fig.10b). Equal numbers of isogenic UMUC3 cells with GFP-tagged empty vector and mCherry-taggedCCDN1episomal ecDNA were co-cultured in the presence of cisplatin or vehicle in a competition assay. This strategy enabled us to model the heterogeneity of ecDNA in UC tumour cells and to longitudinally monitor adaptive fitness to chemotherapy by measuring the ratio of GFP/mCherry fluorescence signals using the Incucyte live cell imaging system (Fig.4a). UMUC3 cells with mCherry-taggedCCND1episomal ecDNA displayed a significantly higher ratio to the GFP-empty vector control cells under cisplatin treatment than with vehicle (2.171 compared with 1.172, FDR-adjustedP= 1.3 × 10−5) (Fig.4b). This suggests positive selection of clones withCCND1ecDNA. Co-cultured mCherry and GFP-expressing cells were then separated after 96 hours of treatment using fluorescence-activated flow sorting and underwent single-cell 10x RNA sequencing to determine howCCND1ecDNA alters their transcriptomic profiles under selective pressure. Cells harbouringCCND1episomal ecDNA significantly activated downstream E2F signalling pathways compared with empty GFP vector cells under vehicle (normalized enrichment score (NES) = 3.45, FDRq< 0.0001) and cisplatin treatment (NES = 3.37, FDRq< 0.0001) (Fig.4c). DNA repair, unfolded protein response and mTORC1 signalling pathways were also differentially upregulated in cells withCCDN1episomal ecDNA compared with empty controls in vehicle and cisplatin conditions, suggesting that these pathways potentially driveCCND1-mediated adaptive fitness (Fig.4d). Cell cycle analysis showed thatCCND1episomal vector-transduced cells exhibited faster G1-to-S transition, with significant decreases in G1 phase proportion in both normal culture and cisplatin treatment conditions (FDR-adjustedP< 0.0037). Under cisplatin treatment, there was also a significant increase in cells in the S phase (FDR-adjustedP= 0.022) (Extended Data Fig.10cand Supplementary Figs.1–5). These data demonstrate thatCCND1ecDNA increases fitness under selective therapeutic pressure by driving cell cycle progression.

*** a, Schematic of experiments using non-integratingCCND1episomal lentiviral vector transduction in the UMUC3 bladder cancer cell line and the competition assay, monitored by Incucyte live-cell imaging and single-cell 10x RNA sequencing.b, Ratio of mCherryCCND1episomal ecDNA to GFP empty cells over 96 h, demonstrating a selective advantage forCCND1ecDNA.n= 25 areas per well. Two-sided unpairedt-test. Data are mean ± s.d. At each 6-h point from 0–96 h, FDR-adjustedP= 0.02, 0.11, 0.12, 0.047, 0.022, 0.0083, 0.0013, 0.00031, 0.00021, 7.1 × 10−5, 8.0 × 10−6, 7.0 × 10−6, 7.0 × 10−6, 7.0 × 10−6, 7.0 × 10−6and 1.3 × 10−5.c, Uniform manifold approximation and projection (UMAP) (left) and boxplot (right) comparing E2F target gene expression scores in single cells with GFP empty control (vehiclen= 7,602, cisplatinn= 8,177) and mCherryCCND1ecDNA (vehiclen= 8,336, cisplatinn= 4,320) under cisplatin (P= 5.3 × 10−91) and vehicle (P= 8.3 × 10−49) treatment. Two-sided Mann–Whitney test.d, Bubble plot showing enriched gene sets for differentially expressed genes between GFP empty control and mCherryCCND1ecDNA samples under vehicle and cisplatin treatments. Bubble sizes represent NES values. Black borders denote significance (FDRq< 0.01).e, JaBbA detection and AmpliconArchitect confirmation of cyclic ecDNA-forming DM events in SF295 cell lines.f, Metaphase FISH showingCCND1amplification on ecDNA.n= 1 independent experiment. Scale bar, 10 µm.g, SDS–PAGE western blot validatingCCND1knockdown.n= 3 independent experiments. For gel source data, see Supplementary Fig.1.h, Schematic ofCCND1shRNA and scramble shRNA control isogenic cell lines in a competition assay under cisplatin selection and monitoring by Incucyte live-cell imaging.i, Cell ratio after 96-h treatment of mCherry-positive cells with shRNA-mediatedCCND1knockdown versus GFP-positive cells with scramble shRNA control, showing reduced fitness of theCCND1knockdown cells (P= 0.034).n= 25 areas per well. One-sided unpairedt-test. Data are mean ± s.d. Image of six-well plate created by KeHan and adapted from Bioicons (https://bioicons.com/), under aCC BY 1.0licence.

*** Source Data

*** To complement the episomal overexpression experiments, we performed shRNA-mediated knockdown ofCCND1encoded byCCND1-amplifying ecDNA in the SF295 cell line. JaBbA and AmpliconArchitect analyses identified DM events generating more than 50 copies ofCCND1ecDNA (Fig.4e) in this cell line. Metaphase FISH confirmed the presence of theseCCND1-amplifying ecDNAs (Fig.4f). We then established isogenic SF295 shRNA-CCND1–mCherry and scramble shRNA-control–GFP cells. SDS–PAGE western blotting confirmedCCND1knockdown (Fig.4gand Supplementary Figs.1–5). Equal numbers of isogenic SF295 cells with shRNA-CCND1–mCherry and scramble shRNA-control–GFP were competitively co-cultured for 96 hours with and without cisplatin (Fig.4h). The reduction in fitness inCCND1knockdown cells was more marked under cisplatin treatment compared to controls (P= 0.034) (Fig.4i). Collectively, our experiments confirm that the acquisition ofCCND1ecDNA significantly enhances the adaptive fitness of tumour cells against chemotherapy.

*** In this study, we performed WGS of matched samples collected from distinct anatomical regions and at consecutive time points from patients with advanced UC. Our analyses revealed a previously uncharted timeline of the activity of two key mutagenic factors: APOBEC3 cytidine deaminases and platinum-based chemotherapy. By comprehensively mapping complex SVs in advanced UC, we identified a high prevalence of ecDNA-forming SVs during UC progression. Notably, ecDNA-forming SVs were mutagenized by APOBEC3 and chemotherapy at distinct time points. Furthermore, we discovered that SV-forming events undergo dynamic evolution incorporating additional DNA segments in the process. This suggests that ecDNA-forming SVs serve as adaptive reservoirs for oncogene amplification25,26and contribute to therapy resistance.

*** Previous pan-cancer studies12,21,27have evaluated the timing and clonality of mutagenic processes of primary tumours but were limited by the paucity of longitudinal samples. Our study analysed serial samples from the same patient using metastatic biopsies and rapid autopsies to reconstruct phylogenetic trees that demonstrated that APOBEC3-induced mutagenesis occurs early in the natural history of UC. Building on our previous work using whole-exome sequencing1, this study used WGS to identify early clonal APOBEC3 mutations in ecDNAs and in benign urothelium, providing support of APOBEC3-induced mutagenesis in the early stages of bladder carcinogenesis. Moreover, the observed early clonal expansion of mutations in chromatin-modifying enzymes within microscopically normal urothelium underscores the key role of APOBEC3-induced mutations in creating early urothelial field defects that are primed for carcinogenesis10,11,28.

*** Our results are aligned with observations of relatively early timing of SBS2 and SBS13 mutations in UC in the PCAWG and TCGA datasets12,14,29, and previous findings of APOBEC3-induced mutations in histologically normal urothelium10,11. These data are also consistent with our previous work showing that the transgenic expression of human APOBEC3G promotes mutagenesis and shorter survival in a murine bladder cancer model7. Previous studies14described the prognostic link between high APOBEC3-induced mutational signatures in primary bladder cancers and improved patient outcomes. Other studies30showed inferior overall survival for patients treated with chemotherapy whose tumours harbour higher APOBEC3-induced mutations.

*** Our data demonstrated that APOBEC3A upregulation induces a significant increase in pRPA foci likely marking ssDNA overhangs at DSB sites marked by γH2AX foci. These data suggest that APOBEC3-induced deamination of small quantities of ssDNA arising under physiological conditions such as DNA replication31can lead to a forward feedback loop that generates additional ssDNA substrates and subsequent episodic bursts of APOBEC3-induced mutagenesis32.

*** Together, these findings highlight the emerging role of the APOBEC3 enzymes as putative drivers of tumorigenesis. These observations present opportunities for cancer control through early detection of actionable APOBEC3-induced driver mutations in the normal urothelium in patients at a higher risk of developing UC and for intercepting this process at the pre-cancerous stages.

*** We quantified the rate of chemotherapy-induced mutations, which generated hundreds of mutations per month of exposure, a finding consistent with previous studies8. These mutations are potentially functionally significant, converging on the same genes in our post-chemotherapy tumours and in cisplatin-resistant bladder cancer cell lines33. Our results align with previous studies implicating VEGFR3, ERBB4, PDGFRβ, RET tyrosine kinase and IFNγ-induced JAK2–STAT3 in cisplatin resistance34,35,36,37,38,39. Targeting these pathways offers a potential avenue for preventing or reversing cisplatin resistance. Notably, cisplatin induces genome-wide mutations rather than specific recurrent hotspot mutations. The acquisition of these ‘off-target’ mutations in pathways not directly related to the primary mechanism of action of the drug potentially contributes to resistance in a pattern similar to that previously implicated in the evolution of microbial resistance40. It is plausible that the accumulation of these ‘off-target’ cisplatin-induced mutations can result in a similar fitness advantage in chemotherapy-treated cancers. These findings add to our understanding of the role of DNA-damaging chemotherapy as a significant mutagenic force that shapes cancer evolution.

*** We identified a significant burden of complex SVs in our UC cohort. We focused on ecDNA-forming SVs that drive tumour evolution and introduce an additional layer of genetic heterogeneity, thus posing additional challenges due to the emergence of therapeutic resistance22,24,41. Using JaBbA2and AmpliconArchitect17, we identified a high prevalence of tyfonas2,19, BFBs16,42and DMs16,43as complex ecDNA-forming SVs. We found thatERBB2andCCND1were involved in these ecDNA-forming SVs often resulting in high CN amplification. These findings are important in light of the recent accelerated approval by the Food and Drug Administration of the antibody–drug conjugate fam-trastuzumab deruxtecan-nxki for metastatic HER2-positive solid tumours, including UC44.

*** The mechanisms of ecDNA biogenesis are not fully understood45, but the occurrence of DNA DSBs followed by DSB repair46is thought to be crucial. Chromothripsis or chromosomal shattering was previously identified as a mechanism driving ecDNA evolution47. The co-occurrence of chromothripsis and kataegis, putatively caused by APOBEC3 enzyme activity48,49, suggest a potential role for APOBEC3-induced DSBs in ecDNA biogenesis. Our findings support this hypothesis by showing the topographical overlap between APOBEC3-induced mutations and ecDNA-forming SV junctions, and the early timing of APOBEC3-induced mutagenesis within these events.

*** Our data suggest that the interaction between ecDNA and chemotherapy-induced mutagenesis compounds subclonal diversification and cancer heterogeneity. Emerging techniques such as single-cell Circle-seq50can characterize the evolution of ecDNA mutagenized by APOBEC3 and chemotherapy in tumour subclones driving aggressive cancer phenotypes.

*** We discovered that the formation of ecDNA-forming SVs is a prevalent mechanism for generatingCCND1CN amplification in UC51. Our analysis shows that UC has the second-highest percentage ofCCND1ecDNA-forming SVs among tumour types in the TCGA/PCAWG pan-cancer cohort21,22. Previous studies have shown thatCCND1is enriched in specific molecular subtypes of bladder cancer, including the Lund Uro subtype52. A detailed understanding of the association ofCCND1ecDNA with molecular subtypes warrants future investigation. AsCCND1ecDNA amplification events were found to co-occur withCDKN2AdelRB1WTtumours, we predict that theCCND1ecDNA-ampCDKN2AdelRB1WTgenotypic configuration promotes cell cycle progression. Notably, we discovered thatCCND1ecDNA-forming-SVs evolve following systemic therapy, increasing their complexity by integrating additional DNA segments. This is consistent with the emerging literature suggesting that ecDNA acts a dynamic pool that is constantly integrating new DNA segments, as a mechanism of adaptive oncogene amplification25,26. New strategies, including the use of DNA-dependent protein kinase inhibitors to disrupt the non-homologous DNA end joining pathway, can limit ecDNA size and inhibit the evolution of resistance to targeted therapy in melanomas25. Similar therapeutic strategies are potentially applicable for intercepting ecDNA-driven resistance in UC.

*** Cyclin D1 has a direct role in DNA damage repair independent of its canonical functions in cell cycle regulation53. It is recruited to DNA damage sites in a BRCA2-dependent manner to promote RAD51 localization and stabilization, thereby playing a direct part in homologous recombination-mediated DSB repair53. This suggests thatCCND1ecDNA promotes therapeutic resistance through multiple mechanisms that work in tandem to enhance proliferative capacity and DNA damage repair. We acknowledge that our data do not directly address the relative contributions of increased cell proliferation versus resistance to cell death inCCND1ecDNA-driven drug resistance. However, our data suggest that inhibiting the CDK4/6 pathway in patients with UC andCCND1ecDNA amplification could lead to significant advances in treating UC. Our group is currently leading the CLONEVO window-of-opportunity clinical trial (ClinicalTrials.gov identifierNCT03837821) of the CDK4/6 inhibitor abemaciclib in patients with UC, which will shed light on the feasibility of this approach.

*** A previous study54showed that high nuclearCCND1expression in metastases is associated with increased responsiveness to chemotherapy but did not translate to improved cancer-specific survival when compared with patients with low nuclearCCND1expression54. This indicates that although highCCND1expression is a potential biomarker for chemotherapy responsiveness, it might also confer enhanced adaptive fitness to tumour cells during therapy, which in turn leads to poorer survival outcomes. Supporting this hypothesis, our findings showed increasedCCND1ecDNA CN after chemotherapy compared with paired treatment-naive tumours. Furthermore, this is consistent with our experimental data demonstrating thatCCND1ecDNA significantly enhances the adaptive fitness of bladder cancer cells to cisplatin treatment.

*** We used a non-integrating lentiviral episomal vector to model the extrachromosomal configuration ofCCND1ecDNA. We observed a marked selection advantage in UMUC3 bladder cancer cells withCCND1ecDNA under selective pressure from cisplatin treatment through E2F-dependent mechanisms. Similarly, knockdown ofCCND1in SF259 cells addicted to highCCND1CN decreased cellular fitness under cisplatin treatment. These findings highlight the crucial role ofCCND1ecDNA in chemoresistance and the promise of therapeutic strategies to reverse this process. Collectively, our findings show complex interactions between therapeutic selective pressures and ecDNA dynamics revealing the functional consequences of ecDNA as a driver of therapy resistance in cancer cells. Our study is underpowered to draw conclusive correlations between mutational and SV events and clinical outcomes. Future WGS studies of larger cohorts of patients with advanced UC tumours with prospective clinical annotation are needed.

*** In conclusion, our findings define the fundamental mechanisms that drive UC evolution. These new insights hold promise for future research and the development of innovative therapeutic strategies aimed at intercepting urothelial carcinogenesis and treatment resistance.

*** All experimental procedures followed approved guidelines and were approved by the Institutional Review Boards (IRBs) at WCM. Recruited patients signed informed consent under IRB-approved protocols: WCM/New York-Presbyterian (NYP) IRB protocols for Tumour Biobanking—0201005295; GU Tumour Biobanking—1008011210; Urothelial Cancer Sequencing—1011011386; and Comprehensive Cancer Characterization (Genomic and Transcriptomic Profiling—1007011157, and Precision Medicine—1305013903). The study was open to all patients with advanced UC at WCM/NYP. Fresh-frozen and FFPE tissues from biopsies, cystectomy and nephroureterectomy specimens from patients with high-grade UC were collected. All pathology specimens were reviewed by board-certified genitourinary pathologists (J.M.M.) at WCM/NYP. Clinical charts were reviewed to record patient demographics, tobacco use, family history of cancer, concurrent cancer, treatment history, anatomical site, pathologic grade and stage using the tumour, node, metastasis (TNM) system.

*** The Englander Institute for Precision Medicine research protocol at WCM/NYP has been established to promote personalized medicine focused on molecular diagnostics and therapeutics. Patients were given the option to be enrolled in the IRB-approved rapid autopsy programme. In addition, patients’ next-of-kin provided written consent before autopsy. A systematic autopsy protocol is followed whereby normal and malignant fresh tissues are collected, allocating samples to be snap-frozen or formalin-fixed. The goal is to maximize the amount of tissue collected for research purposes. Once tissue collection is complete, the autopsy proceeds per the WCM Autopsy Service protocol. In this study, tissues from multiple sites were collected, with DNA extracted for WGS following haematoxylin and eosin evaluation and frozen slide annotation.

*** WGS libraries were prepared using a KAPA Hyper PCR+ library preparation kit following the manufacturer’s instructions. Before library preparation, FFPE samples were repaired using PreCR Repair Mix (NEB) followed by additional DNA quantification. For library preparation, DNA was sheared using a Covaris LE220. DNA fragments were end-repaired, adenylated and ligated to Illumina sequencing adapters. Libraries went through two post-ligation bead clean-ups, PCR amplification and a final post-PCR bead clean-up. Final library quality was verified using a KAPA qPCR Library Quantification kit (Roche) and a Fragment Analyzer (Agilent). Libraries were normalized, pooled and sequenced on an Illumina NovaSeq 6000 sequencer using 2 × 150 bp cycles.

*** The New York Genome Center (v.6) somatic pipeline55was used to align the data and call variants. In brief, sequencing reads were aligned to GRCh38 with BWA-MEM (v.0.7.15)56. Short alignments were removed with NYGC ShortAlignmentMarking (v.2.1) (https://github.com/nygenome/nygc-short-alignment-marking), and mate-pair information was added with GATK FixMateInformation (v.4.1.0)57. Individual lane BAMs were merged and sorted simultaneously with Novosort markDuplicates (v.1.03.01), followed by GATK BQSR. SNVs, multi-nucleotide variants and indels were called using MuTect2 (GATK v.4.0.5.1)58, Strelka2 (v.2.9.3)59and Lancet (v.1.0.7)60. SVs were called using Svaba (v.0.2.1)61, Manta (v.1.4.0)62and Lumpy (v.0.2.13)63, with Svaba used for both indels and SVs. Split-read support for SVs was quantified using SplazerS (v.1.1)64. Germline variants were called on the matched normal samples with GATK HaplotypeCaller (v.3.5) and filtered with GATK VQSR at tranche 99.6%. The positions of heterozygous germline variants were used to compute B allele frequencies in the tumour samples. Variants were merged across callers and annotated using Ensembl (v.93)65, COSMIC (v.86)66, 1000Genomes (Phase3)67, ClinVar (201706)68, PolyPhen (v.2.2.2)69, SIFT (v.5.2.2)70, FATHMM (v.2.1)71, gnomAD (r.2.0.1)72and dbSNP (v.150)73using Variant Effect Predictor (v.93.2)74. Somatic variants that occurred in two or more individuals in our in-house panel of normals were removed, as well as SNV/indels that had minor allele frequency ≥1% in 1000Genomes or gnomAD, and SVs overlapping with DGV (2020-02-25 release)75, 1000Genomes or gnomAD-SV (v.2.0.1)76. SNV/indels with tumour VAF <0.0001, normal VAF >0.2, depth <2 in either the tumour or normal sample, and normal VAF greater than tumour VAF were filtered from the final callset. SNV/indels with support from two or more callers were marked as high confidence. SVs with support from two or more callers or one caller with split-read or CNV changepoint support were marked as high confidence. Variants detected by the somatic calling pipeline in the FFPE normal tissues were removed from the tumour samples. None of the 77 remaining tumour samples was excluded from the analyses due to the absence of ABOPEC mutational signatures.

*** Purity and ploidy were estimated for each sample using AscatNGS (v.4.2.1)77and Sequenza (v.3.0.0)78. Estimates were manually reviewed and chosen based on VAF, B-allele frequency and read depth fit. Owing to low purity, six tumours were excluded from downstream JaBbA analysis.

*** Our study included 83 samples: 77 histologically proven UCs and 5 morphologically normal urothelial samples from 50 patients. Five normal urothelium samples were only included in the comparisons between primary and metastatic tumours and normal urothelial samples. The bladder cancer (primary bladder adenocarcinoma) sample from patient WCMIVG101 was only used for ONT long-read WGS. This was a cross-sectional genomic cohort study of patients with advanced UC. Basic covariates (including sex, age at diagnosis, smoking status, highest stage, primary or metastatic tumour, site of tumour collection and platinum-based chemotherapy status) are listed in Supplementary Table1.

*** For patients with multiple samples, a union of ‘HighConfidence’ somatic SNVs and indels across all the patient’s samples was generated. Pileup (v.0.15.0) (https://github.com/pysam-developers/pysam) was then run on tumour and normal BAM files to compute the counts for variants present in the union variant call format (VCF) file that were missing from each sample’s VCF. Variants that had a VAF > 0 were then rescued and added to the sample VCF. The resulting ‘union VCF’ was used for further post-processing.

*** Mutational signature fitting was performed using the R package deconstructSigs (v.1.9)79. HighConfidence variants were input, and COSMIC (v.3.2) signatures (https://cancer.sanger.ac.uk/signatures/)66was used as a reference. Arguments ‘contexts.needed=TRUE’ and ‘signature.cutoff=0’ were used for SBS, DBS and ID signatures. Additionally, the experimentally derived SBS.A3G from our APOBEC3G transgenic mouse model7was included to fit the signatures in patients’ tumours. Following signature fitting, for each SNV, we computed a channel of 78 posterior probabilities (corresponding to each of the SBS reference signatures) that the mutation was caused by a given COSMIC signature (similar to ref.80). After discarding posterior probabilities below 0.5, the most likely signature was chosen. The assignment was discarded if the trinucleotide context was not one of the top 5 reference signature peaks. APOBEC (SBS2 and SBS13) and platinum chemotherapy (SBS31 and SBS35) were treated separately based on previous knowledge (SBS2: C>T; SBS13: C>A, C>G; SBS31: C>T, T>A; SBS35: C>A, C>G, C>T, T>A). We then refined platinum chemotherapy assignments using patient clinical data. For samples from patients who did not receive platinum chemotherapy, SBS31 and SBS35 mutation assignments were removed. For patients with multiple samples, SBS31 and SBS35 mutation assignments were removed for mutations occurring in both pre-chemotherapy and post-chemotherapy samples. However, if a mutation was unassigned in one post-chemotherapy sample but was assigned to SBS31 or SBS35 in another post-chemotherapy sample from the same patient, the mutation in the first sample was reassigned.

*** Mutational signature assignments of variants in the normal urothelium were determined using matched tumours from the same patient. Pileup (v.0.15.0) (https://github.com/pysam-developers/pysam) was run on the normal urothelium, using positions with a SBS2 or SBS13 assignment in the matched tumours. Variants with VAF > 0 were counted towards the number of variants assigned to a given mutational signature in the normal urothelium.

*** To investigate the timing of ageing (SBS1), APOBEC (SBS2 and SBS13) and chemotherapy (SBS31 and SBS35) mutational processes, we computed a signature clonality fold change as previously described8. To compute the clonal versus subclonal fold change for each post-chemotherapy sample, we pooled all MutationTimer12clonal categories (early clonal, late clonal, clonal (NA), subclonal) and divided the proportion of clonal mutations by the proportion of subclonal mutations assigned to the same signature. The early versus late fold change was similarly calculated. Mutation counts were pooled for their respective COSMIC signatures. Only samples with sufficient purity for upstream JaBbA analysis were included.

*** For Fig.1b, we includedn= 12 patients with multiple samples who received platinum chemotherapy. Truncal mutations were node alterations shared by all samples in a tree, whereas leaf mutations were node alterations unique to each sample. To statistically substantiate the observation that APOBEC signatures dominated early truncal nodes whereas chemotherapy-associated signatures dominated later leaf nodes in phylogenetic trees, we calculated the fold change of their variants for each patient by dividing the fraction of variants associated with a mutational signature in leaf nodes by the fraction in truncal nodes for each patient. To avoid dividing by zero, a pseudo-count of 1 variant was added before the fold change calculation.

*** The list of chromatin-modifying genes was curated from REACTOME81and from previous publications14,82,83. Duplicate genes were removed. The CGC gene list is described in the section ‘Oncoprint of chemotherapy-induced mutations’. Notably, among the 743 CGC genes examined, 47 genes overlapped with the 259 chromatin-modifying genes, aligning with the frequent observations of mutations in chromatin-remodelling genes in cancer84. Control genes were randomly sampled from 500 genes not in the list of CGC genes and chromatin-modifying genes (Supplementary Table5). The Ensembl variant effect predictor (VEP)74was used to assign functional impact predictions to the detected variants, whereas the R package MutationTimeR (v.1.00.2)12was used to compute the clonality and CCF for each variant (see the section ‘Mutation timing and CCF calculation’). Moderate-impact and high-impact variants predicted by the VEP were analysed to prioritize early urothelial mutations with functional consequences.

*** Mutagenic velocity (rate of signature accumulation per month of exposure) was calculated for ageing (SBS1), APOBEC (SBS2, SBS13 and DBS11) and platinum chemotherapy (SBS31, SBS35 and DBS5) signatures. Mutation counts from signatures fitted by deconstructSigs79was divided by the exposure time to mutagenic processes (months). The estimated exposure time for ageing and chemotherapy was between the date of sample collection and the date of birth or the date of the initial chemotherapy treatment, respectively. For patients with an unknown initial diagnosis date, it was assumed to be 1 year before the earliest date of tissue collection. Duration from birth and date of diagnosis were retroactively calculated from age at diagnosis and sample collection dates. For APOBEC, the exposure time is assumed to be from the sample collection dating back to 10 years before the UC diagnosis date, as we expected that APOBEC mutagenesis occurs long before the diagnosis of UC. All samples were given one pseudo count of the ageing signature to prevent division by zero in samples with no ageing signature contribution. Samples with zero APOBEC signature contribution and post-chemotherapy samples with zero chemotherapy contribution were excluded from the calculation. The velocity induced by each mutational process within patients with multiple samples was averaged. Fold change was calculated by dividing APOBEC and chemotherapy velocity by ageing velocity.

*** To address the biological significance of the mutations induced by cisplatin treatment, we examined mutations in coding regions assigned to SBS31 and SBS35, which are induced by previous treatment with platinum-based chemotherapy. CGC genes were curated from Cancer Gene Consensus (CGC v.95 Tier 1 and 2 genes) and TCGA 2017 BLCA driver genes, excluding FLAGS (frequently mutated genes)85, withBRCA2,KMT2CandKMT2Drescued back into the gene list.

*** We investigated the association between alterations in driver genes and the presence of SV types using a predefined gene list (Supplementary Table5). For each combination of gene and SV type, we conducted association tests using the Fisher’s test with a FDR threshold of <0.25. The tested associations included moderate to high impact SNVs/indels, amplifications, a combination of amplifications and SNVs/indels, homozygous deletions and a combination of homozygous deletions and SNVs/indels.

*** We used three databases for analysis: FANTOM5 for promoters86(209,911 promoters, 4.2 MB), FANTOM5 for enhancers87(63,285 enhancers, 18.6 MB) and previously described super-enhancers88(8,589 super-enhancers, 468.5 MB, with the union taken across 86 cell types). The initial step involved overlaying all SNVs onto these features, disregarding mutational signature assignment, for a comprehensive starting point in our analysis. We then conducted FishHook analysis to identify any regulatory elements that are mutated more than expected based on background. We re-used covariates from FishHook SV analysis (see the section ‘Regions of recurrent structural variation’), and used the union (ignoring strand) of promoters, enhancers and super-enhancers as the list of hypotheses to test. Each patient could only contribute one mutation per hypothesis. We included local mutation density as a covariate and kept the FDR cut-off at 0.25.

*** Enrichr refers to an integrative web-based search engine of various gene set libraries and methods to compute gene set enrichment with interactive visualization of the enrichment results89,90,91. In this study, we interrogated the NCI-Nature 2016 pathway database to search for pathways showing a significant increase in the number of mutations assigned to platinum chemotherapy-induced SBS31 and SBS35. ThePvalue was computed from a two-sided Fisher’s exact test, and pathways with adjustedP≤ 0.2 are reported. The enriched pathways were visualized by Appyter available at Enrichr.

*** The R package MutationTimeR (v.1.00.2)12was run using the union of somatic variants, allele-specific CN output from JaBbA, patient sex information and previously estimated purity values. Parameter n.boot was set to 200. MutationTimeR infers a multiplicity for each mutation and assigns a timing based on the multiplicity and the allele-specific CN configuration at that locus. Using MutationTimeR multiplicities, CCF was computed as previously described92.

*** Phylogenetic trees were generated using LICHeE (v.1.0)93for each patient with multiple samples. LICHeE was run with a variant-by-CFF matrix as input, the ‘maxVAFAbsent’ argument of 0.0, the ‘minVAFPresent’ argument of 0.5, the ‘maxClusterDist’ of 0.2, and in cell prevalence mode (-cp). The top-scoring tree was selected. The variants in each of the resulting nodes of the phylogenetic tree output were then fed through deconstructSigs as described above to estimate a set of mutational signature proportions for each node.

*** Genes with evidence of positive selection were detected using the R package dndscv94,95,96using default parameters and GRCh38-specific reference data as supplied by the developers. As per the developer’s instructions, mutations shared across multiple samples from the same patient were only listed once. This method of calculating the dN/dS ratio adjusts for other confounders of clonal selection, such as large gene sizes and a high regional mutation rate97. The following classification was used: dN/dS = 1, neutral selection; dN/dS > 1, positive selection; dN/dS < 1, negative selection. Higher missense and nonsense dN/dS ratios indicate a clonal selection of oncogenes and tumour suppressor genes, respectively.

*** Read counts were corrected for GC percentage and mappability in 1-kb bins using fragCounter (https://github.com/mskilab/fragCounter) for all tumour and normal samples. A coverage panel of normal was built from the normal samples and used to denoise the tumour coverage data using dryclean (commit bda8065)98. Denoised tumour coverage profiles, B allele frequencies and high-confidence SVs were used as input to JaBbA (v.1.1)2, an algorithm that integrates CNV and SVs into a junction-balanced genome graph, computing integer copy numbers for both. Default parameters were used, except for the slack penalty, which was increased to 1,000. Simple inversions, translocations, duplications and deletions, as well as TICs, quasi-reciprocal pairs, rigma, pyrgo, tyfonas, BFB cycles and DMs, were called on the junction-balanced genome graph using the JaBbA companion R package gGnome (commit c390d80)2. Using the integer CN as output by JaBbA, we computed the fraction of genome altered, defined here as the proportion of autosomes not in a neutral copy state, as defined by sample ploidy. For samples with an intermediate average ploidy (fractional value of 0.4–0.6, for example, 3.5), the copy-neutral state was set as the closest two integer values (for example, for a ploidy of 3.5, the copy-neutral states would be 3 and 4). Otherwise, the copy-neutral state was set as the rounded ploidy.

*** A Gamma–Poisson model, as implemented in the R package FishHook (commit 06e3927)99, was used to discover regions of recurrent SVs. The genome was partitioned into 100-kb non-overlapping bins, and the union of breakpoints from each patient was used as input as previously described100. Regions overlapping intervals of mappability <1 and centromeres >25% were excluded from the analysis. Covariates were added to model the background mutation rate, including the following:

*** Nucleotide frequency, dinucleotide frequency and trinucleotide frequency

*** H3K4me3 marks (ENCODE accession: ENCFF191IBA), H3K27ac marks (ENCFF208GHP), H3K4me1 marks (ENCFF759BRD), H3K3me3 marks (ENCFF983DSU)

*** DNase hypersensitivity sites (ENCFF823HYK)

*** Replication timing (https://github.com/skandlab/MutSpot/tree/master/features/Ch38), fragile sites (HGNC 2021) and

*** RepeatMasker long interspersed nuclear element, short interspersed nuclear element, long terminal repeat, simple repeat and DNA transposon annotations from UCSC101.

*** A FDR-adjusted (Benjamini–Hochberg)Pvalue cut-off of 0.25 was used to nominate significant breakpoint hits. Cancer-related genes were from the COSMIC Cancer Gene Consensus102.

*** We noted that JaBbA does not impose any kind of cyclic constraint when calling high-level amplifications (for example, DMs, tyfonas and BFBs). To determine whether these events were ecDNA-forming SVs, AmpliconArchitect (v.1.2)17was run using default parameters on tumour BAMs downsampled to 10x, considering only intervals with integer CNs greater than 4 (inferred by JaBbA) and longer than 10 kb. For two runs on which these parameters could not be applied, we used 10x downsample, CN > 5 and 100-kb intervals. Any high-level amplifications detected by JaBbA overlapped with an AmpliconArchitect-detected cyclic amplicon were nominated as ecDNA-forming SVs.

*** We ran the SigProfilerClusters (v.1.1.2)103software with default parameters to identify kataegis loci, computing a sample-dependent inter-substitution distance of clustered mutations and requiring a kataegis event to have a consistent VAF. Kataegis events contained completely within the footprint of an ecDNA-forming SV are classified as kyklonas.

*** As a secondary method for determining the relative contributions and timing of mutational processes acting on ecDNA, we partitioned SNVs in ecDNA-forming SVs by VAF into three groups (VAF ≤ 0.333, 0.333 < VAF ≤ 0.667 and VAF > 0.667) for each sample. We then ran deconstructSigs as described above and VAF combination, requiring that a particular combination have at least 50 SNVs. The relative contribution of APOBEC and chemotherapy mutageneses on ecDNA-forming SVs are presented in Fig.2f, and all mutational processes in Extended Data Fig.6a.

*** The AmpliconArchitect analyses from a previous study22were accessed from GitHub. Samples were from both TCGA and PCAWG datasets (based on their identifiers, either SA-XXXX or TCGA-XXXX). Sample barcodes from all specimens were analysed for amplicon intervals corresponding to the genomic location ofCCND1(chromosome 11: 69455855–69469242). The resulting amplicon intervals were then matched to the type of amplification event (heavily rearranged, circular-BFB or linear) as determined by AmpliconArchitect. Only oneCCND1amplification event was identified in cervical cancer and none in B cell lymphoma, glioblastoma, sarcoma, renal or colorectal cancer. TheCDKN2AandCCND1mutation and CN status of bladder cases havingCCND1amplicons were retrieved from cBioPortal. The study abbreviations for different cancer types are listed on the National Cancer Institute website (https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables/tcga-study-abbreviations).

*** STAR aligner (v.2.7.3a)104was run in two-pass mode (--twoPassMode Basic105) versus GRCh38. The STAR index was created using Gencode (v.39) for splice junction annotation, with overhang=99, and including only canonical chromosomes (chromosomes 1–22, X, Y and M). Gencode (v.28) was used for gene quantification. The GTF was filtered to include only genes from the following types (‘gene_type’ field): protein_coding, lincRNA, antisense, IG_LV_gene, IG_V_gene, IG_V_pseudogene, IG_D_gene, IG_J_gene, IG_J_pseudogene, IG_C_gene, IG_C_pseudogene, TR_V_gene, TR_V_pseudogene, TR_D_gene, TR_J_gene, TR_J_pseudogene, TR_C_gene. This filtering was performed using the ‘mkgtf’ utility from CellRanger (https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/advanced/references#mkgtf). Transcripts annotated as ‘retained_intron’ were also excluded, using the script collapse_annotation.py from the GTex pipeline (https://github.com/broadinstitute/gtex-pipeline/tree/master/gene_model) with argum–t --collapse_only. This filtering was performed to avoid under-counting due to overlap for instances in which genes from these categories overlapped other gene types (like pseudogene versions of the same gene) or in which genes would otherwise be non-overlapping except for ‘retained_intron’ isoforms. The featureCounts106module from the subread package (v.1.4.3-p1) was used for read quantification, with the argument ‘-s 2’ for strand-specific samples and argument ‘-s 0’ for non-strand-specific samples. The module ComBat_seq107from the sva package (R v.4.1.3, sva v.3.42.0) was used for batch correction. The samples were treated as four batches based on prep type, with a 2 × 2 design for ‘totalRNA’ or physical rRNA removal versus ‘mRNA’ or poly-A selection, and strand-specific versus non-strand-specific. The 39 samples with corresponding DNA were included. DNA and RNA were extracted from the same tumour sample within the same patient except when tumour tissues were not sufficient for both. DESeq2 (R v.3.6.1, DESeq2 v.1.24.0)108was used for library size normalization after batch correction. DESeq2 was also used to perform differential expression between samples with versus without gain ofCCND1CN. Gain is defined as CN gain relative to ploidy.

*** The co-occurence ofCCND1amplification and homozygous loss ofCDKN2Awas determined using Fisher’s exact test (fisher.test in R v.4.0.0).CCND1amplification was defined as having a gene modal copy number (CN) greater than two times the sample ploidy or greater than 8. Homozygous loss ofCDKN2Awas defined as having a gene modal CN of zero. Separate Fisher’s exact tests were performed withinCCND1amplifications, splitting by ecDNA-forming SV status, and across the entire cohort, comparingCCND1ecDNA-forming SV+toCCND1ecDNA-forming SV–samples.

*** To determine the impact ofCCND1alterations on clinical outcomes, we queried data from 10,953 patients (10,967 samples) across 32 cancer types included in the Pan-Cancer Atlas109from cBioPortal (https://bit.ly/4cjAYof). Out of 10,622 patients with overall survival data available, 2,128 patients hadCCND1alterations, including CN gains and CN amplifications. We performed survival analysis using the built-in survival function of cBioPortal.

*** The JaBbA amplicon footprints corresponding to each of the putativeCCND1ecDNA-forming SVs were intersected, which produced a single 204 kb genomic interval (chromosome 11: 69614476–69818943). This interval was uploaded as a custom track in UCSC Genome Browser101. Additional tracks selected included NCBI RefSeq gene models (release 2023-03-21), FANTOM5 transcription start site peaks86, and H3K27Ac, H3K4Me1 and H3K4Me3 marks from ENCODE110. A tutorial on how to operate the interactive browser interface is available at GitHub (https://github.com/mskilab-org/gGnome.js/blob/master/README.md#the-ggnomejs-interface).

*** For each putative ecDNA-forming SV (for example, JaBbA-called tyfonas, DMs or BFBs overlapping an AmpliconArchitect cyclic call), the amplicon-associated subgraph was extracted from the full JaBbA genome graph. Each amplicon was then decomposed into constituent walks using the ‘peel’ function in the R package gGnome (commit c390d80), using junction CN to rank walks. In brief, ‘peel’ attempts to iteratively decompose a subgraph by finding walks through the graph that maximize some junction feature (here, JCN). For each iteration, the top-ranked walk was ‘peeled’ off of the subgraph, and the procedure was repeated.

*** After obtaining a set of walks for each amplicon, the non-cyclic walks and walks containing genomic intervals with CNs fewer than eight were removed. Each walk that passed the aforementioned filters was then compared against the associated AmpliconArchitect cyclic event. The best overlapping walk was then kept, and the others were discarded. Finally, walks with reciprocal overlap ≥80% were selected for visualization with CycleViz (v.0.1.5)111(https://github.com/AmpliconSuite/CycleViz). The preset BUSHMAN was used for displaying oncogenes contained within ecDNA reconstructions.

*** Samples were fragmented to 10 kb using Covaris g-TUBE (COVARIS, 520079). DNA repair and end-prep were performed using the NEBNext Companion Module for ONT (NEB, E7180S), incubating at 20 °C for 5 min, followed by 5 min at 65 °C. The sample was cleaned up using 1× Ampure XP beads (Beckman Coulter, A63881) and washed twice on a magnetic rack with 80% ethanol. Sequencing adaptors and ligation buffer from an Oxford Nanopore Ligation Sequencing kit (ONT, LSK1114) were ligated to DNA ends using Quick T4 DNA ligase (NEB, E6056) for 45 min at room temperature. The sample was cleaned up using 0.45× Ampure XP beads (Beckman Coulter, A63881), washing twice on a magnetic rack with the long-fragment buffer (ONT, LSK114) before eluting in 32 µl of elution buffer (ONT, LSK114). Sequencing libraries were prepared by adding the following to the eluate: 100 µl sequencing buffer (ONT, LSK114), 68 µl loading solution (ONT, LSK114) and 0.5 µl sequencing tether (ONT, LSK114). Samples were run on a PromethION (R10.4.1) flow cell using the PromethION sequencer. Sequencing runs were operated using MinKNOW software (v.23.07.12). Live base-calling was performed in high accuracy (HAC) mode. Read N50 was 12,186 bp, and mean coverage was 58×.

*** ONT reads were aligned to GRCh38 with minimap2 (v.2.26-r1175)112with flags -a–L -–D --cs -x map-ont, and coordinate-sorted with samtools (v.1.18)113. Reads overlapping the amplified regions of interest were extracted to FASTQ using samtools and used as input into assembly. A total of 196,924 long reads overlappedCCND1ecDNA reference coordinates with N50 10,087 and mean coverage 1,403×. GRCh38 ALT contig chr11_KI270827v1_alt overlapped one of the regions of interest and had many reads aligned to it instead of the corresponding locus on chromosome 11, so these were included in the assembly for the relevant amplicon. Reads were assembled with Flye (v.2.9.2-b1786)114in metagenomics mode, with the –nano-hq setting and –read-error set to 0.03 as recommended for ONT Q20+ chemistry. A single round of polishing was used. Following assembly, the Flye assembly summary was reviewed to confirm that a circular contig was assembled. The assembled contig was mapped back to GRCh38 using minimap2 with assembly alignment preset -ax asm5 for confirmation that the assembly footprint on the reference genome matched the amplicon detected using Illumina sequencing.

*** Bladder cancer cell lines UMUC3 (CRL-1749) and 5637 (HTB-6), and HEK293T (CRL-3216) were purchased from the American Type Culture Collection. The SF295 cell line was purchased from Neuromics (SF-001). Cell lines UMUC3, 5637 and SF295 were validated by STR testing and/or morphology by the manufacturer. The UMUC3, SF295, 5637 and HEK293T cells were incubated in a humidified constant 37 °C and 5% CO2incubator in EMEM (ATCC), RPMI-1640 (Gibco) (for SF295 and 5637) and DMEM (Gibco) medium, respectively, with 100 U ml–1penicillin–streptomycin (Gibco) and 10% tetracycline-free FBS (Omega Scientific). The cells were tested negative forMycoplasmacontamination with a PCR detection kit (ABM) according to the manufacturer’s instructions.

*** The non-integrating lentiviral episomal vector we used in this study has homogeneous long terminal repeat regions that promote the circularization of the transducedCCND1DNA. As this vector is integrase-deficient, it models the extrachromosomal configuration ofCCND1ecDNA. Finally, the scaffold/matrix attachment region (S/MAR) sequence, which interacts with the nuclear matrix through scaffold attachment factor A (SAF-A), ensures the self-replication and partitioning of the episome during mitosis115. The pBMN (CMV-copGFP-Puro-SMAR) plasmid, a gift from M. Essand (Addgene, 80391)116, was modified to include a mCherry-T2A-5′HA-taggedCCND1coding sequence, synthesized with XbaI and AgeI sites by Integrated DNA Technologies. Following digestion with XbaI and AgeI, the fragment was cloned into the pBMN vector between the CMV promoter and Puro-SMAR sequence using T4 DNA ligase (New England BioLabs) (Supplementary Figs.1–5). This plasmid was transformed into One Shot Stbl3 Chemically CompetentEscherichia coli(Thermo Fisher Scientific) and collected using a PureLink HiPure Plasmid Filter Maxiprep kit (Thermo Fisher Scientific), according to the manufacturer’s instructions. The shRNACCND1knockdown plasmid (pLV-mCherry-T2A-Puro-U6-shRNA) and shRNA control plasmid (pLV-EGFP-T2A-Puro-U6-scramble control) were generated by VectorBuilder. The targetCCND1sequence was TGTTGTAAGAATAGGCATTAA. The plasmids were validated by Sanger sequencing.

*** HEK293T cells were transfected with the interested plasmid in combination with pPAX2 and pVSV-G plasmids (Addgene). The virus-containing medium was collected every 24 h for 3 days post-transfection, filtered using a 0.22-µm sterile 50 ml tube top filter (Corning) and concentrated using Lenti-X Concentrator (Takara). The concentrated lentivirus was used for transduction with 10 µg ml–1polybrene (Millipore Sigma). Transduced cells were selected using 2 µg ml–1puromycin (Gibco). The expression level was validated by SDS–PAGE western blotting of cyclin D1.

*** The GFP-tagged pBMN empty vector UMUC3 cells were co-cultured with mCherry-tagged pBMNCCND1episomal ecDNA UMUC3 cells in a 1:1 ratio, initially seeded into a 6-well plate. Likewise, scramble shRNA SF295 cells were co-cultured withCCND1knockdown SF295 cells in a 1:1 ratio, initially seeded into a 6-well plate. After 24 h of seeding, the co-cultured cells were treated with 1.5 µM cisplatin or vehicle control. Cisplatin (at the stock concentration of 1 mg ml–1) was freshly dissolved in medium instead of DMSO to prevent loss of activity117and was protected from light. Each 6-well plate was then placed in the Incucyte system (Sartorius) for live tracking of GFP and mCherry signals every 6 h. To sustain the selective pressure of cisplatin, the medium containing cisplatin was refreshed after 48 h. For replicates, 25 spots within each well were imaged. After 96 h of monitoring, GFP and mCherry signals were quantified using Incucyte software (Incucyte, 2022B, Rev2). Subsequently, the ratio of mCherry and GFP signal area was calculated and normalized to the baseline (time 0) measurements.

*** The competitive assay experiment was repeated in T75 flasks for single-cell RNA sequencing to identify the impact ofCCDN1episomal ecDNA on the transcriptional profiles under selective pressure. Following a 96-h exposure to either vehicle or cisplatin (1.5 µM), live cells tagged with GFP and mCherry were isolated using fluorescence-activated cell sorting (BD FACSAria II) and subsequently processed by the WCM genomic core facility. The 10x Genomics chromium single-cell 3′ library RNA sequencing kit was used to construct libraries, and sequencing was performed using Illumina NovaSeqXplus with paired-end sequencing, producing read 1 of 28 bp and read 2 of 90 bp.

*** The obtained sequencing data underwent processing through 10x cellranger (v.7.1.0) with the ‘ --include-introns’ option set to false. Specifically, cellranger mkfastq was used to generate Fastq files. For the alignment, we used the 10x prebuilt GRCh38-2020-A human reference.

*** Raw single-cell RNA sequencing results of four samples (vehicle–GFP, vehicle–mCherry, cisplatin–GFP and cisplatin–mCherry) were processed using CellRanger (v.7.1.0). Matrix files for each pair of samples (GFP and mCherry cells under the same treatment) were read with Scanpy (v.1.9.6)118and concatenated in the same AnnData object (v.0.10.3)119. Cells were filtered to have at least 200 genes and a mitochondrial count below 20%. Genes were filtered to those present in at least three cells. Transcriptomes were normalized by their total size and scaled to 10,000 UMI counts, and highly variable genes were selected using Scanpy pp.highly_variable_genes function with batch_key=‘sample’. The data matrix underwent logarithmic transformation using the natural logarithm using Scanpy pp.log1p function. We scaled the gene expression per gene by subtracting the mean and dividing by the standard deviation using the Scanpy pp.scale function. Then we performed principal component analysis using the Scanpy tl.pca function with svd_solver = ‘arpack’ and performed batch correction using Harmony120.

*** The E2F score was calculated in each single cell by calculating the average expression of all 200 genes in the E2F target pathway from the Molecular Signatures Database (MSigDB)121subtracted the average expression of a reference set of genes using the Scanpy tl.score_score_genes function. We constructed ak-nearest neighbour graph using the pp.neighbors function from Scanpy, setting the number of neighbours to 25 and the number of principal components to 40. We then applied UMAP for dimensionality reduction using the Scanpy tl.umap function for each anndata pair (GFP and mCherry cells under the same treatment). For visualizing E2F transcription factor activity across individual cells, we generated a UMAP colour-coded by the pre-calculated E2F score to differentiate between low and high E2F activity states. We then plotted E2F scores as boxplots and statistically compared the E2F score between each pair of samples using the Mann–Whitney test.

*** To compare the transcriptomic profiles between each pair of samples (GFP and mCherry cells under the same treatment), we performed differential expression of genes on pre-processed anndata between GFP and mCherry samples under each treatment usingt-test as implemented in Scanpy tl.rank_genes_groups function. Gene enrichment analysis of significantly upregulated and downregulated genes was done using the GSEApy package (v.1.1.1) with the GSEApy prerank function. Differentially regulated pathways were identified using gene set enrichment analysis from the GSEA (Broad Institute) package based on signatures from MSigDB (MSigDB_Hallmark_2020)121. Bubble plots of enriched gene sets were generated based on NESs and associated FDRqvalue.

*** The UMUC3 bladder cancer cells were seeded in a 6-well plate and cultured for 24 h, followed by overnight synchronization in serum-free medium. Cells were then treated with either EMEM with 10% FBS or EMEM with 10% FBS with 1.5 µM cisplatin, freshly prepared without DMSO. After 24 h, cells were collected, resuspended in 200 µl of ice-cold PBS, and dropwise fixed with 3 ml of 80% ice-cold ethanol while vortexing to minimize clumping, then stored overnight at −30 °C. The fixed cells were washed with PBS to remove the ethanol and stained with a DAPI solution (1 mg ml–1, BD Pharmingen, diluted 1:1,000 in 0.1% Triton X-100 PBS) for 30 min at room temperature in the dark. Stained cells were analysed on a BD LSRFortessa flow cytometer (BD Biosciences) using a 405 nm laser with a 450/50 nm emission filter. The DNA content was analysed using FlowJo (BD Biosciences), for which cell gating was based on forward and side scatter to isolate single cells, and cell cycle proportions were calculated using the Dean–Jett–Fox model122.

*** CCND1(labelled green) and centromeric chromosome 11 (labelled orange) probes were used (Empire Genomics). Before use, all probes were validated on metaphase spreads.

*** To assess extrachromosomalCCND1localization, the bladder cancer cell line UMUC3 and the human glioblastoma cell line SF295 were first treated with colcemid (0.1 µg ml–1) for 1 h to obtain a metaphase preparation. A hypotonic solution was added, then cells were fixed in methanol and acetic acid (3:1). The fixed cells were placed on microscopy glass slides and dried for 1 week at room temperature. Prepared slides were dehydrated in a series of ethanol. Probes were then added to the slides, which were denatured and hybridized, washed and then counterstained with DAPI before visualization.CCND1was considered present in ecDNA when the green signal was observed outside the chromosome spread, and the centromeric chromosome 11 served as control2.

*** To assess gene amplification,CCND1enumeration from interphase FISH was carried out on FFPE tissue slides (5 µm thick).CCND1amplification was determined by a ratio ofCCND1gene signal (green) to centromere signal (orange) higher than two. A minimum of 100 nuclei per slide were scored. Analysis was carried out using a fluorescence microscope (Olympus BX51; Olympus Optical). CytoVision (v.7.3.1) software (Leica Biosystems) was used for imaging123,124.

*** Cells were grown to 80% confluency in a 15-cm dish and metaphase-arrested by adding KaryoMAX colcemid (10 µl ml–1, Gibco) for 1–2 h. Cells were washed with PBS, trypsinized (Gibco) and centrifuged at 200gfor 10 min. We added 10 ml of 0.075 M KCl preheated to 37 °C, 1 ml at a time, vortexing at maximum speed in between. Afterwards, cells were incubated for 20 min at 37 °C. Then, 5 ml of ice-cold 3:1 methanol and acetic acid (kept at −20 °C) was added, 1 ml at a time, followed by resuspension of the cells by flicking the tube. The sample was centrifuged at 200gfor 5 min. Addition of the fixative followed by centrifugation was repeated four times. Two drops of cells within 200 µl of methanol and acetic acid were dropped onto prewarmed slides from a height of 15 cm. Slides were incubated overnight.

*** Cells were lysed with RIPA buffer with added protease inhibitor (Thermo Fisher Scientific) to produce whole protein lysate. Protein concentration was determined using a Pierce BCA assay (Thermo Fisher Scientific). The lysate was run on a 10% SDS–PAGE gel with MOPS buffer and transferred using an iBlot system (Thermo Fisher Scientific). Rabbit anti-cyclin D1 (Abcam, ab134175, 1:2,000), mouse anti-α-tubulin (Millipore, 05-829, 1:1,000), mouse anti-Rb (Cell Signaling Technology, 9309S, 1:1,000), rabbit anti-phospho-Rb (Ser807/811) (Cell Signaling Technology, 8516S, 1:2,000) and rabbit anti-p16INK4A(Cell Signaling Technologies, 80772, 1:1,000) antibodies were separately used as primary antibodies at 4 °C overnight. HRP-conjugated secondary antibodies (goat anti-rabbit, 32260, and goat anti-mouse, 32230, Invitrogen, 1:1,000) were incubated for 1 h at room temperature. Blots were developed using Luminata Forte Poly HRP substrate (Millipore) reagent, imaged on a ChemiDoc imager (Bio-Rad) and analysed using Image Lab (Bio-Rad v.6.1.0) software.

*** All-in-one doxycycline-inducible lentivirus backbone includedAPOBEC3AcDNA with HA-tag and Venus with continuously expressing promoter was a gift from M. D. Weitzmann125,126. The lentivirus was transduced into the 5637 bladder cancer cell line, followed by the fluorescence-activated cell sorting of Venus-positive cells. APOBEC3A expression level was validated by SDS–PAGE western blotting using a HA-tag antibody.

*** Cells were plated on Chamber slides (ThermoFisher Scientific) and treated with vehicle (DMSO) or doxycycline for 24 h. Cells were fixed in 4% paraformaldehyde at room temperature for 10 min. The fixed nuclei were treated with 0.5% Triton X-100 in PBS and blocked by 2.5% normal goat serum in PBS. Mouse anti-phospho-histone H2A.X (Ser139) antibody (Cell Signaling Technology, 80312, 1:1,000) and rabbit anti-phospho RPA32 (S4/S8) antibody (Bethyl Fortis Life Sciences, A300-245A, 1:1,000) were used as the primary antibodies and incubated at 4 °C overnight. Then, AlexaFluor 488-conjugated AffiniPure donkey anti-rabbit antibody (Jackson ImmunoResearch Laboratories, 711-545-152, 1:1,000) and AlexaFluor 594-conjugated AffiniPure donkey anti-mouse antibody (Jackson ImmunoResearch Laboratories, 715-585-150, 1:1,000) were used as secondary antibodies and incubated for 2 h at room temperature. Negative blank controls were included by omitting primary antibodies in the protocol. After that, the slide was sealed with ProLong Diamond Antifade mountant with DAPI (Invitrogen, p36962). High-resolution imaging was performed using a fluorescent microscope (Axioscop 2 M2 with Plan Apochromat 633/1.4 NA oil differential interference contrast objective; Carl Zeiss) with a camera (CoolSNAP HQ; Photometrics) using the AF488 filter (38 HE GFP) and AF594 filter on the Axio Imager M2. Multiple fields of view for each condition were randomly picked for imaging.Zstacks (0.25 µm) were collected and subjected to constrained iterative deconvolution using Zeiss deconvolution software (Zen desk v.3.7). Images were processed using Fiji ImageJ (v.154f) software127. Each image was stacked using theZ-stacked function of the software with the ‘Max intensity’ property. The number of nuclei in each image was manually counted in the blue DAPI channel, discarding cells with areas less than 80% present in the image. Cells were considered pRPA-positive if they formed ≥5 discrete foci or γH2AX-positive if they formed ≥5 discrete foci within nuclei128. Mann–Whitney test was used to statistically compare percentages of positive nuclei between the two treatments using GraphPad Prism (v.10.2.0).

*** Two-sided Wilcoxon rank-sum test, two-sidedt-test or Pearson test for continuous variables was performed using R (v.4.0.0) software. Unless specified otherwise,P< 0.05 was considered significant.

*** The studies involving human participants were reviewed and approved by the WCM IRB. Patients and participants provided their written informed consent to participate in this study. Written informed consent was obtained from the individual(s) for the publication of any potentially identifiable images or data included in this article.

*** Further information on research design is available in theNature Portfolio Reporting Summarylinked to this article.

